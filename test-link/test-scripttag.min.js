const currentScriptSrc=new URL(document.currentScript.src);(async()=>{if(top===window)return;const t=window.Shopify?.shop,e=window.Shopify?.theme?.role;if(!t||"main"!==e)return;const o=new URLSearchParams(location.search),r=o.get("source"),c=o.get("oseid");if(r||!c)return;if(window[t])return;window[t]=c;const n=btoa(t+c).replace(/=+$/,""),a=await cookieStore.get(n),i=[];for await(const t of document.head.querySelectorAll('script[defer="defer"][data-app-id]')){const e=parseInt(t.getAttribute("data-app-id"),10);e&&i.push(e)}i.sort(((t,e)=>t-e));const s=btoa(JSON.stringify(i)),p=`${n}=${s}; Path=/; SameSite=None; Secure`;document.cookie=p;const d=a?.value;if(d===s){const t=currentScriptSrc.searchParams,e=`${atob(t.get("p"))}?shop=${t.get("shop")}`;await fetch(e),document.cookie=p+"; Max-Age=0"}})();